# 인덱스 강제병합
강제병합 API는 한개 이상의 인덱스를 강제 병합할 수 있게 해줍니다. 병합은 각각 파편을 가지고 있는 루씬 인덱스의 세그먼트 수와 관련이 있습니다. 강제 병합 동작은 이것을 병합시켜서 세그먼트의 수를 줄일 수 있게 해줍니다.

이 명령은 병합이 완료되기까지 대기합니다. 만약 HTTP 접속이 유실되면 요청은 백그라운드에서 계속 동작을 할 것 입니다. 또 다른 요청은 직전의 강제병합이 완료될 때까지 대기합니다.
```
curl -XPOST 'localhost:9200/twitter/_forcemerge?pretty'
```
## 요청 파라미터
강제병합 API는 다음과 같은 요청파라미터를 가지고 있습니다.

| 파라미터명 | 내용 |
| -- | -- |
| ```max_num_segments``` | 병합될 세그먼트 수 입니다. 만약 전체 통합을 하고자 할 경우에는 *1*을 설정하시면 됩니다. 기본적으로는 병합을 해야되는지 판단을 하고 필요할 경우에만 진행을 합니다. |
| ```only_expunge_deletes``` | 삭제정보가 있는 세그먼트에 대해서만 병합을 진행합니다. 루씬에서는 문서는 세그먼트에서 삭제되지 않고 삭제 표시만 합니다. 세그먼트에 대한 병합이 진행될 때 삭제정보가 없는 새로운 세그먼트가 생성됩니다. 기본값은 ```false```이며 ```index.merge.policy.expunge_deletes_allowed``` 설정을 덮어쓰지 않습니다. |
| ```flush``` | 병합 후 정리작업을 하는지 여부입니다. 기본값은 ```ture```입니다. |

## 다중 인덱스
강제병합 API는 한번의 요청에 한개 이상의 인덱스 처리가 가능합니다. 또한 ```_all```을 사용하여 전체처리도 가능합니다.
```
curl -XPOST 'localhost:9200/kimchy,elasticsearch/_forcemerge?pretty'
curl -XPOST 'localhost:9200/_forcemerge?pretty'
```